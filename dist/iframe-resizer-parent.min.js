class IFrameResizer{constructor(iframe,options={}){const defaultOptions={targetOrigin:"*",log:false,onResize:null,onScroll:null,initData:{}};this.options={...defaultOptions,...options};this.iframe=iframe instanceof HTMLElement?iframe:document.querySelector(iframe);if(!this.iframe){this.log("Iframe element not found or selector invalid.",null,true,false);return}this.customMessageHandlers=new Map;this.isReady=false;this.readyCallback=null;this.handleMessage=this.handleMessage.bind(this);window.addEventListener("message",this.handleMessage);this.onMessage("ready",payload=>{this.isReady=true;this.log("Child iframe is ready",payload);if(this.readyCallback){this.readyCallback(payload)}});this.log("ParentIFrameResizer initialized")}onReady(callback){if(this.isReady){callback()}else{this.readyCallback=callback}return this}onMessage(type,callback){if(typeof type!=="string"){this.log(`Invalid type for message handler. Expected a string, but received:`,typeof type,true,false);return this}if(typeof callback!=="function"){this.log(`Invalid callback for message handler. Expected a function, but received:`,typeof callback,true,false);return this}this.customMessageHandlers.set(type,callback);this.log(`Custom message handler registered for type: ${type}`);return this}handleMessage(event){if(event.source!==this.iframe.contentWindow){this.log("Message received, but it is not from the expected iframe source.");return}this.log("Message received",event.data);if(typeof event.data!=="object"||event.data===null||!event.data.type){this.log("Invalid message format or missing type in event data.",event.data);return}const{type,...payload}=event.data;switch(type){case"resize":if(typeof this.options.onResize==="function"){this.options.onResize(payload.width,payload.height)}else{this.log("No onResize handler defined in options.",payload)}break;case"scroll":if(typeof this.options.onScroll==="function"){this.options.onScroll(payload.left,payload.top)}else{this.log("No onScroll handler defined in options.",payload)}break;default:if(this.customMessageHandlers.has(type)){try{const handler=this.customMessageHandlers.get(type);handler(payload,event);this.log(`Custom message processed: ${type}`,payload)}catch(error){this.log(`Error in custom message handler for type: ${type}`,error,true)}}else{this.log(`No handler registered for message type: ${type}`,payload,false,true)}}}sendMessage(type,data={}){if(!this.iframe||!this.iframe.contentWindow){this.log("Error: Iframe not found or contentWindow not available.",{iframe:this.iframe});return}if(!type||typeof type!=="string"){this.log("Error: Message type is invalid or not specified.",{type:type});return}if(!this.options.targetOrigin||this.options.targetOrigin==="*"){this.log('Warning: Sending message to a potentially insecure targetOrigin ("*")',{targetOrigin:this.options.targetOrigin})}try{this.iframe.contentWindow.postMessage({type:type,...data},this.options.targetOrigin);this.log("Message sent to iframe",{type:type,data:data,targetOrigin:this.options.targetOrigin})}catch(error){this.log("Error sending message to iframe:",error)}}log(message,data=null,error=false,warn=false){if(this.options.log){if(!error&&!warn){console.log(`[LOG][IFRAME PARENT][${window.location.host}]: ${message}`,data)}else if(error){console.error(`[LOG][IFRAME PARENT][${window.location.host}]: ${message}`,data)}else{console.warn(`[LOG][IFRAME PARENT][${window.location.host}]: ${message}`,data)}}}destroy(){this.log("Destroying ParentIFrameResizer");window.removeEventListener("message",this.handleMessage);this.customMessageHandlers.clear()}}